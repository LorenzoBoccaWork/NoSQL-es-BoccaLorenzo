### Task 1.1
Inserire un utente

db.users.insertOne({
  name: {
    first: "Jessica",
    last: "Taylor"
  },
  email: "jessica.taylor@example.com",
  phone: "+1-555-0166",
  address: {
    street: "456 Oak Avenue",
    city: "San Francisco",
    state: "CA",
    zipCode: "94102",
    country: "USA",
    coordinates: {
      lat: 37.7749,
      lng: -122.4194
    }
  },
  role: "customer",
  status: "active"
})

---------------- Risposta terminale -----------------------
{
  acknowledged: true,
  insertedId: ObjectId('68f8c82eb83ce627ae8ce9a2')
}

### 1.2
Inserire un prodotto

db.products.insertOne({
  sku: "SMARTPHONE-IPHONE-15-PRO",
  name: "iPhone 15 Pro",
  category: "Electronics",
  subcategory: "Smartphones",
  price: 999.00,
  specifications: {
    display: {
      size: "6.1 inches",
      type: "OLED",
      resolution: "2556 x 1179"
    },
    processor: {
      model: "A17 Pro",
      cores: 6,
      gpu: "Apple GPU (6-core)"
    },
    memory: {
      ram: "8GB",
      storage: "256GB"
    },
    camera: {
      rear: {
        main: "48MP",
        ultrawide: "12MP",
        telephoto: "12MP"
      },
      front: "12MP"
    }
  },
  status: "active"
})

-------------- Risposta terminale -------------
{
  acknowledged: true,
  insertedId: ObjectId('68f8c875b83ce627ae8ce9a3')
}

### 2.1
Trova tutti gli utenti che vivono a "San Francisco"

db.users.find({ "address.city": "San Francisco" })

-------------- Risposta terminale -----------------
{
  _id: ObjectId('68f8c82eb83ce627ae8ce9a2'),
  name: {
    first: 'Jessica',
    last: 'Taylor'
  },
  email: 'jessica.taylor@example.com',
  phone: '+1-555-0166',
  address: {
    street: '456 Oak Avenue',
    city: 'San Francisco',
    state: 'CA',
    zipCode: '94102',
    country: 'USA',
    coordinates: {
      lat: 37.7749,
      lng: -122.4194
    }
  },
  role: 'customer',
  status: 'active'
}

### 2.2
Trovare tutti gli utenti in California (state: "CA")

db.users.find({ "address.state": "CA" })

---------------- Risposta terminale -----------------
Mi ha dato tutti gli utenti di California con state "CA"

### 2.3
Trovare i prodotti con una dimensione del display di 6.1 pollici

db.products.find({ "specifications.display.size": "6.1 inches" })

### 2.4
Trovare i prodotti con "8GB" di RAM

db.products.find({ "specifications.memory.ram": "8GB" })

### 2.5
Trovare i prodotti dove il display è Oled e lo storage è 256GB

db.products.find({
  "specifications.display.type": "OLED",
  "specifications.memory.storage": "256GB"
})


### 3.1
Cambiare l'indirizzo di Jessica in "789 Pine Street"

db.users.updateOne(
  { email: "jessica.taylor@example.com" },
  { $set: { "address.street": "789 Pine Street" } }
)

------------------ Risposta terminale ---------------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 3.2
Aggiornare utente Jessica

db.users.updateOne(
  { email: "jessica.taylor@example.com" },
  {
    $set: {
      "address.city": "Los Angeles",
      "address.state": "CA",
      "address.zipCode": "90001"
    }
  }
)

----------------- Risposta terminale -------------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 3.3
Aggiornare la fotocamera frontale dell'iPhone a "15MP"

db.products.updateOne(
  { sku: "SMARTPHONE-IPHONE-15-PRO" },
  { $set: { "specifications.camera.front": "15MP" } }
)

------------------ Risposta terminale -----------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 3.4
Aggiornare di nuoto utente Jessica

db.users.updateOne(
  { email: "jessica.taylor@example.com" },
  {
    $set: {
      "address.coordinates.lat": 34.0522,
      "address.coordinates.lng": -118.2437
    }
  }
)

------------------ Risposta terminale -------------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 4.1
Sostituire l'intero indirizzo di Jessica con uno nuovo

db.users.updateOne(
  { email: "jessica.taylor@example.com" },
  {
    $set: {
      address: {
        street: "321 Maple Drive",
        city: "Seattle",
        state: "WA",
        zipCode: "98101",
        country: "USA"
      }
    }
  }
)

------------------- Risposta terminale --------------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 4.2
Qual è la differenza tra questi due approcci?

1) db.users.updateOne(
  { email: "user@example.com" },
  { $set: { "address.city": "Boston" } }
)

2) db.users.updateOne(
  { email: "user@example.com" },
  { $set: { address: { city: "Boston" } } }
)

--------------- Risposta terminale -----------------
Mi sono accorto guardando sul terminale:
Approccio 1: Aggiorna solo il campo city
Approccio 2: Sostituisce l'intero oggetto address con Boston

### 5.1
Aggiungere una nuova specifica all'iPhone, batteria 3200 mAh

db.products.updateOne(
  { sku: "SMARTPHONE-IPHONE-15-PRO" },
  { $set: { "specifications.battery": "3200mAh" } }
)

---------------- Risposta terminale -----------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 5.2
Aggiungere informazioni di spedizione all'indirizzo di Jessica

db.users.updateOne(
  { email: "jessica.taylor@example.com" },
  {
    $set: {
      "address.shipping": {
        allowPOBox: false,
        requireSignature: true
      }
    }
  }
)

------------------- Risposta terminale -------------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 6.1
Inserire un utente con molteplici metodi di pagamento

db.users.insertOne({
  name: { first: "Robert", last: "Anderson" },
  email: "robert.anderson@example.com",
  paymentMethods: {
    creditCard: {
      last4: "1234",
      brand: "Visa",
      expiryMonth: 12,
      expiryYear: 2025
    },
    paypal: {
      email: "robert.paypal@example.com",
      verified: true
    }
  },
  role: "customer",
  status: "active"
})

---------------- Risposta terminale ------------------
{
  acknowledged: true,
  insertedId: ObjectId('68f8cfbeb83ce627ae8ce9a4')
}

### 6.2
Trovare gli utenti che hanno un account PayPal verificato

db.users.find({ "paymentMethods.paypal.verified": true })

--------------- Risposta terminale ------------------

{
  _id: ObjectId('68f8cfbeb83ce627ae8ce9a4'),
  name: {
    first: 'Robert',
    last: 'Anderson'
  },
  email: 'robert.anderson@example.com',
  paymentMethods: {
    creditCard: {
      last4: '1234',
      brand: 'Visa',
      expiryMonth: 12,
      expiryYear: 2025
    },
    paypal: {
      email: 'robert.paypal@example.com',
      verified: true
    }
  },
  role: 'customer',
  status: 'active'
}

### 6.3
Aggiornare le ultime 4 cifre della carta di credito di Robert a "5678"

db.users.updateOne(
  { email: "robert.anderson@example.com" },
  { $set: { "paymentMethods.creditCard.last4": "5678" } }
)

------------- Risposta terminale -----------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 7
Gli ordini dovrebbero essere incorporati nei documenti utente o in una collezione separata?

Opzione A (Incorporati):
{
  _id: ObjectId("..."),
  email: "user@example.com",
  orders: [
    { orderId: 1, date: "2024-01-15", total: 99.99 },
    { orderId: 2, date: "2024-01-20", total: 149.99 }
    // ... potenzialmente centinaia di ordini
  ]
}
Opzione B (Referenziati):
// collezione users
{ _id: ObjectId("user123"), email: "user@example.com" }

// collezione orders
{ _id: ObjectId("order456"), userId: ObjectId("user123"), total: 99.99 }
{ _id: ObjectId("order789"), userId: ObjectId("user123"), total: 149.99 }

------------- Risposta ------------------
Meglio l'opzione B in quanto è scalabile, possono contenere molte informazioni e spesso è necessario interrogare gli ordini in modo indipendente dagli utenti

### 8.1
Aggiungere un riepilogo delle recensioni (incorporato) a un prodotto

db.products.updateOne(
  { sku: "LAPTOP-DELL-XPS13" },
  {
    $set: {
      reviewsSummary: {
        average: 4.5,
        count: 127,
        distribution: {
          "5star": 78,
          "4star": 32,
          "3star": 12,
          "2star": 3,
          "1star": 2
        },
        featured: [
          {
            author: "Jane D.",
            rating: 5,
            comment: "Best laptop ever!",
            helpful: 45
          }
        ]
      }
    }
  }
)

-------------- risposta terminale ------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 0,
  modifiedCount: 0,
  upsertedCount: 0
}

### 8.2
Aggiungere le preferenze dell'utente (incorporate)

db.users.updateOne(
  { email: "user@example.com" },
  {
    $set: {
      preferences: {
        theme: "dark",
        language: "en",
        notifications: {
          email: true,
          sms: false,
          push: true,
          frequency: "daily"
        },
        privacy: {
          showEmail: false,
          showPhone: false,
          allowMarketingEmails: true
        }
      }
    }
  },
  { upsert: true }
)

---------------- Risposta terminale -------------------
{
  acknowledged: true,
  insertedId: ObjectId('68f8d19e902df766fe2147c0'),
  matchedCount: 0,
  modifiedCount: 0,
  upsertedCount: 1
}