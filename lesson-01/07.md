### Task 1.1
Inserire un prodotto con tag multipli

db.products.insertOne({
  sku: "CAMERA-CANON-EOS-R5",
  name: "Canon EOS R5",
  category: "Electronics",
  price: 3899.00,
  tags: ["camera", "professional", "mirrorless", "4k", "canon"],
  features: ["45MP sensor", "8K video", "IBIS", "Dual card slots"],
  status: "active"
})

--------------- Risposta terminale -----------------
{
  acknowledged: true,
  insertedId: ObjectId('68f8d213b83ce627ae8ce9a5')
}

### 1.2
Inserisci un utente con un array

db.users.insertOne({
  name: { first: "Lisa", last: "Chen" },
  email: "lisa.chen@example.com",
  interests: ["photography", "travel", "technology", "cooking"],
  favoriteProducts: [], 
  role: "customer",
  status: "active"
})

---------------- Risposta terminale -------------------
{
  acknowledged: true,
  insertedId: ObjectId('68f8d26cb83ce627ae8ce9a6')
}

### 2.1
Trova i prodotti etichettati con "camera"

db.products.find({ tags: "camera" })

------------------- RIsposta terminale ----------------
{
  _id: ObjectId('68f8d213b83ce627ae8ce9a5'),
  sku: 'CAMERA-CANON-EOS-R5',
  name: 'Canon EOS R5',
  category: 'Electronics',
  price: 3899,
  tags: [
    'camera',
    'professional',
    'mirrorless',
    '4k',
    'canon'
  ],
  features: [
    '45MP sensor',
    '8K video',
    'IBIS',
    'Dual card slots'
  ],
  status: 'active'
}

### 2.2
Trovare i prodotti con ALMENO UNO di questi tag: "sale", "clearance", "discount"

db.products.find({
  tags: { $in: ["sale", "clearance", "discount"] }
})

------------------ RIsposta terminale -----------
Non mi da niente.
Ho provato a mettere findOne e come valore mi ritorna null

### 2.3
Trovare i prodotti che hanno tutti questi tag: "wireless", "premium"

db.products.find({
  tags: { $all: ["wireless", "premium"] }
})

------------ Risposta terminale -------------------
{
  _id: ObjectId('68f112ac6bfae6d8ac0e2d70'),
  sku: 'HDPHN-SONY-WH1000XM6',
  name: 'Sony WH-1000XM5 Wireless Headphones',
  description: 'Industry-leading noise cancellation with premium sound quality',
  category: 'Electronics',
  subcategory: 'Headphones',
  brand: 'Sony',
  price: 359.99100000000004,
  currency: 'USD',
  tags: [
    'wireless',
    'noise-cancelling',
    'premium',
    'bluetooth'
  ],
  status: 'active',
  featured: true,
  specifications: {
    type: 'Over-ear',
    connectivity: 'Bluetooth 5.2',
    batteryLife: '30 hours',
    noiseCancellation: true
  },
  createdAt: 2025-10-16T15:43:40.099Z,
  lastUpdated: 2025-10-22T09:18:30.163Z
}

### 2.4
Trovare i prodotti con esattamente 5 tag

db.products.find({
  tags: { $size: 5 }
})

------------------- Risposta terminale ------------------
{
  _id: ObjectId('68f8d213b83ce627ae8ce9a5'),
  sku: 'CAMERA-CANON-EOS-R5',
  name: 'Canon EOS R5',
  category: 'Electronics',
  price: 3899,
  tags: [
    'camera',
    'professional',
    'mirrorless',
    '4k',
    'canon'
  ],
  features: [
    '45MP sensor',
    '8K video',
    'IBIS',
    'Dual card slots'
  ],
  status: 'active'
}

### 2.5
Trovare gli utenti che non hanno ancora prodotti preferiti

1) db.users.find({
  favoriteProducts: { $size: 0 }
})

2) // Oppure
db.users.find({
  favoriteProducts: []
})

3) // Oppure controlla se esiste ma è vuoto
db.users.find({
  favoriteProducts: { $exists: true, $size: 0 }
})

------------------ Risposta del terminale ----------------
1) db.users.find({
  favoriteProducts: { $size: 0 }
})
2) {
  _id: ObjectId('68f8d26cb83ce627ae8ce9a6'),
  name: {
    first: 'Lisa',
    last: 'Chen'
  },
  email: 'lisa.chen@example.com',
  interests: [
    'photography',
    'travel',
    'technology',
    'cooking'
  ],
  favoriteProducts: [],
  role: 'customer',
  status: 'active'
}
3) {
  _id: ObjectId('68f8d26cb83ce627ae8ce9a6'),
  name: {
    first: 'Lisa',
    last: 'Chen'
  },
  email: 'lisa.chen@example.com',
  interests: [
    'photography',
    'travel',
    'technology',
    'cooking'
  ],
  favoriteProducts: [],
  role: 'customer',
  status: 'active'
}

### 3.1
Aggiungere il tag "featured" alla fotocamera Canon

db.products.updateOne(
  { sku: "CAMERA-CANON-EOS-R5" },
  { $push: { tags: "featured" } }
)

--------------- Risposta terminale ----------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 3.2 
Aggiungere i tag "new-arrival" e "bestseller" alla fotocamera Canon

db.products.updateOne(
  { sku: "CAMERA-CANON-EOS-R5" },
  {
    $push: {
      tags: { $each: ["new-arrival", "bestseller"] }
    }
  }
)

---------------- Risposta terminale -------------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 3.3
Aggiungere il tag "premium" alla fotocamera Canon, ma solo se non esiste già

db.products.updateOne(
  { sku: "CAMERA-CANON-EOS-R5" },
  { $addToSet: { tags: "premium" } }
)

------------------- Risposta terminale ----------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 3.4
Aggiungere tag multipli, ma solo se non esistono già

db.products.updateOne(
  { sku: "CAMERA-CANON-EOS-R5" },
  {
    $addToSet: {
      tags: { $each: ["high-end", "recommended"] }
    }
  }
)

------------------ Risposta terminale -------------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 4.1
Rimuovere tag "featured" dalla fotocamera Canon

db.products.updateOne(
  { sku: "CAMERA-CANON-EOS-R5" },
  { $pull: { tags: "featured" } }
)

------------ RIsposta terminale ----------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 4.2
Rimuovere i tag "new-arrival" e "sale" da un prodotto

db.products.updateOne(
  { sku: "CAMERA-CANON-EOS-R5" },
  { $pull: { tags: { $in: ["new-arrival", "sale"] } } }
)

---------------- Risposta terminale ------------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 4.3
Rimuovi l'ultimo tag dalla fotocamera Canon

db.products.updateOne(
  { sku: "CAMERA-CANON-EOS-R5" },
  { $pop: { tags: 1 } }
)

---------------- Risposta terminale -----------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 4.4
Rimuovi il primo tag dalla fotocamera Canon

db.products.updateOne(
  { sku: "CAMERA-CANON-EOS-R5" },
  { $pop: { tags: -1 } }
)

------------------ Risposta terminale --------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 5.1
Inserisci un prodotto con un array di recensioni incorporato

db.products.insertOne({
  sku: "BOOK-MONGODB-GUIDE",
  name: "MongoDB: The Definitive Guide",
  category: "Books",
  price: 49.99,
  reviews: [
    {
      author: "Alice",
      rating: 5,
      comment: "Excellent book!",
      date: new Date("2024-01-15")
    },
    {
      author: "Bob",
      rating: 4,
      comment: "Very informative",
      date: new Date("2024-01-18")
    }
  ],
  status: "active"
})

------------- Risposta terminale ---------------------
{
  acknowledged: true,
  insertedId: ObjectId('68f8d905b83ce627ae8ce9a7')
}

### 5.2
Aggiungi una nuova recensione al libro su MongoDB

db.products.updateOne(
  { sku: "BOOK-MONGODB-GUIDE" },
  {
    $push: {
      reviews: {
        author: "Charlie",
        rating: 5,
        comment: "Best MongoDB resource!",
        date: new Date()
      }
    }
  }
)

------------------ Risposta terminale -----------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### Task 5.3
Trovare i prodotti con almeno una recensione a 5 stelle

db.products.find({
  "reviews.rating": 5
})

---------------- Risposta terminale --------------------
{
  _id: ObjectId('68f8d905b83ce627ae8ce9a7'),
  sku: 'BOOK-MONGODB-GUIDE',
  name: 'MongoDB: The Definitive Guide',
  category: 'Books',
  price: 49.99,
  reviews: [
    {
      author: 'Alice',
      rating: 5,
      comment: 'Excellent book!',
      date: 2024-01-15T00:00:00.000Z
    },
    {
      author: 'Bob',
      rating: 4,
      comment: 'Very informative',
      date: 2024-01-18T00:00:00.000Z
    },
    {
      author: 'Charlie',
      rating: 5,
      comment: 'Best MongoDB resource!',
      date: 2025-10-22T13:16:31.523Z
    }
  ],
  status: 'active'
}

### Task 5.4
Trovare i prodotti con recensioni dove rating è 5 E e author "Alice"

db.products.find({
  reviews: {
    $elemMatch: {
      rating: 5,
      author: "Alice"
    }
  }
})

---------------- Risposta terminale -----------------
{
  _id: ObjectId('68f8d905b83ce627ae8ce9a7'),
  sku: 'BOOK-MONGODB-GUIDE',
  name: 'MongoDB: The Definitive Guide',
  category: 'Books',
  price: 49.99,
  reviews: [
    {
      author: 'Alice',
      rating: 5,
      comment: 'Excellent book!',
      date: 2024-01-15T00:00:00.000Z
    },
    {
      author: 'Bob',
      rating: 4,
      comment: 'Very informative',
      date: 2024-01-18T00:00:00.000Z
    },
    {
      author: 'Charlie',
      rating: 5,
      comment: 'Best MongoDB resource!',
      date: 2025-10-22T13:16:31.523Z
    }
  ],
  status: 'active'
}

### 6.1
Aggiorna il rating della recensione di Alice a 5

db.products.updateOne(
  {
    sku: "BOOK-MONGODB-GUIDE",
    "reviews.author": "Alice"
  },
  {
    $set: { "reviews.$.rating": 5 }
  }
)

---------- Risposta terminale ----------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 0,
  upsertedCount: 0
}

### 6.2
Aggiorna la seconda recensione

db.products.updateOne(
  { sku: "BOOK-MONGODB-GUIDE" },
  {
    $set: {
      "reviews.1.comment": "Updated comment"
    }
  }
)

-------------- Risposta terminale -----------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 6.3
Rimuovere la recensione di Alice

db.products.updateOne(
  { sku: "BOOK-MONGODB-GUIDE" },
  {
    $pull: {
      reviews: { author: "Alice" }
    }
  }
)

------------------- Risposta terminale -----------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 7.1
Aggiungi un nuovo tag "editor-choice" all'inizio dell'array

db.products.updateOne(
  { sku: "CAMERA-CANON-EOS-R5" },
  {
    $push: {
      tags: {
        $each: ["editor-choice"],
        $position: 0
      }
    }
  }
)

---------------- Risposta terminale -----------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 7.2
Aggiungi nuovi tag e ordina l'array alfabeticamente

db.products.updateOne(
  { sku: "CAMERA-CANON-EOS-R5" },
  {
    $push: {
      tags: {
        $each: ["new-tag-1", "new-tag-2"],
        $sort: 1
      }
    }
  }
)

------------------ Risposta terminale -------------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

### 7.3
Aggiungere nuove recensioni ma mantieni solo le 5 più recenti

db.products.updateOne(
  { sku: "BOOK-MONGODB-GUIDE" },
  {
    $push: {
      reviews: {
        $each: [{
          author: "Dave",
          rating: 4,
          comment: "Good book",
          date: new Date()
        }],
        $sort: { date: -1 },
        $slice: 5
      }
    }
  }
)

------------ Risposta terminale -------------------
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}
